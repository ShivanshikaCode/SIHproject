<!DOCTYPE html>
<html>
<head>
  <title>Rooftop Area Calculator</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css"/>
  <style>
    #map { height: 90vh; width: 100vw; }
    body { margin:0; padding:0;}
    .info-box { position: absolute; top: 20px; left: 20px; background: white; padding: 12px; z-index: 1000; border-radius: 6px; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="info-box" id="info">Draw your rooftop polygon on the map!</div>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>
  <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
  <script>
    // Center India
    var map = L.map('map').setView([20.5937, 78.9629], 5);

    // Free satellite tiles: OSM does not provide high-res satellite, but ESRI offers a free satellite tile for non-commercial use
    var esriSat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      attribution: 'Tiles © Esri'
    }).addTo(map);

    // Try to get user's location
    map.locate({setView: true, maxZoom: 19});

    var drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);

    var drawControl = new L.Control.Draw({
      draw: { polygon: true, marker: false, circle: false, rectangle: false, polyline: false, circlemarker: false },
      edit: { featureGroup: drawnItems }
    });
    map.addControl(drawControl);

    map.on('draw:created', function (e) {
      var type = e.layerType,
          layer = e.layer;

      drawnItems.clearLayers(); // Only one polygon active
      drawnItems.addLayer(layer);

      var geojson = layer.toGeoJSON();
      var area = turf.area(geojson);
      var infoBox = document.getElementById('info');
      infoBox.innerHTML = "Rooftop Area: <b>" + area.toFixed(2) + " m²</b>";
    });

    // On location found, center map
    map.on('locationfound', function(e){
      map.setView(e.latlng, 19);
    });

    // Handle location error
    map.on('locationerror', function(e){
      document.getElementById('info').innerHTML = "Location access denied. Zoom and pan to your building manually.";
    });
  </script>
</body>
</html>
